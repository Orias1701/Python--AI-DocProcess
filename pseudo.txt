Xét 3 đoạn văn bản liền kề: Đoạn đang xét là [1], đoạn ngay trước nó là [0].

Khi nói Style[0] == Style[1] cần so sánh các thuộc tính:
{
        Text[0] Style = Text[1] Style
    or  Text[0] Style = Text[1] Words.Last.Style
    or  Text[0] Words.First.Style = Text[1] Style
    or  Text[0] Words.First.Style = Text[1] Words.Last.Style
}

Các Function dùng cho gộp lines thành Para:

isNewPara(): MarkerText[1] != null
isSameFontSize(): FontSize[0] == Fontsize[1] +- 0.7

isSameStyle(): Style[0] == Style[1]
isSameCaseStyle(): Style[0]/1000 == Style[1]/1000
isSameFontStyle(): Style[0]%1000 == Style[1]%1000

isNearerPre(): Top[1] < Top[0] * 1.3
isNearerNex(): Top[1] < Bot[1] * 1.3
isNear(): isNearerPre() && isNearerNex() && Top[1] < LineHeight[1] * 4.0

isSameAlign(): Align[0] == Align[1]
isEnoughSpace_R(): MarginRight[0] < FirstWord[1]*1.3
isEnoughSpace_L(): MarginLeft[0] < FirstWord[1]*1.3
isEnoughSpace(): isEnoughSpace_R() && notEnoughSpace_L()
isSentenceEnd(): LastWord[0] == "." || "!" || "?" || ";" || ":"

isBadAlign(): Align[0] != "right" && Align[1] == "right"
isNoSameAlign0(): Align[0] == "justify"
isNoSameAlignC(): Align[0] == "center"
isNoSameAlignR(): Align[0] == "right"
isNoSameAlignL(): Align[0] == "left" && Align[1] == "justify"

canMergeWithAlign(): isNoSameAlign0() || isNoSameAlignC() || (isNoSameAlignR() && Align[1] != "center") 
canMergeWithLeft(): isNoSameAlignL()

Điều kiện Merge 2 đoạn [0] và [1]: 
canMerge():
  if    isNewPara() || !isSameCaseAndStyle() || !isSameFontSize() || !isNear() return false
  elif  isSameAlign() return True
  elif  isBadAlign() return False
  elif  canMergeWithAlign() || canMergeWithLeft() return True

Giữ nguyên general, chỉ Merge trong lines
Đoạn văn được merge sẽ có các thuộc tính sau của đối tượng sau.

    {
      "Paragraph": Đánh số tự động,
      "Text": Text sau khi đã gộp ngăn cách bằng space,
      "MarkerText": của line đầu tiên trong nhóm,
      "MarkerType": của line đầu tiên trong nhóm,
      "Style": 4 chữ số, mỗi chữ số đều lấy min chữ số tương ứng của các line
      "FontSize": Trung bình cộng các line trong nhóm, làm tròn 1 chữ số thập phân,
      "Align": "Lấy phổ biến của các đoạn đã merge hoặc của đoạn cuối cùng đã merge nếu không có đoạn nào",
      "Words": {
          "First": của line đầu tiên trong nhóm
          "Last": của line cuối cùng trong nhóm
        },
    },
